{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/lib/auth.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = global.__prisma || new PrismaClient()\r\nif (!global.__prisma) global.__prisma = prisma\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret'\r\nconst JWT_EXPIRES_IN = '7d'\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET)\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getUserFromToken(token) {\r\n  const data = verifyToken(token)\r\n  if (!data || !data.userId) return null\r\n  const user = await prisma.user.findUnique({ where: { id: data.userId } })\r\n  return user\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,SAAS,yDAAO,QAAQ,IAAI,IAAI,6IAAY;AAClD,IAAI,CAAC,yDAAO,QAAQ,EAAE,yDAAO,QAAQ,GAAG;AAExC,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAEhB,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACnE;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,iBAAiB,KAAK;IAC1C,MAAM,OAAO,YAAY;IACzB,IAAI,CAAC,QAAQ,CAAC,KAAK,MAAM,EAAE,OAAO;IAClC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI,KAAK,MAAM;QAAC;IAAE;IACvE,OAAO;AACT"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/pages/api/users/%5Bid%5D/role.js"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\nimport { getUserFromToken } from '../../../../lib/auth'\r\n\r\nlet prisma\r\nif (!global.__prisma) {\r\n  global.__prisma = new PrismaClient()\r\n}\r\nprisma = global.__prisma\r\n\r\nexport default async function handler(req, res) {\r\n  const { id } = req.query\r\n  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' })\r\n\r\n  const auth = req.headers?.authorization || req.headers?.Authorization || ''\r\n  const token = auth.startsWith('Bearer ') ? auth.slice(7) : null\r\n  if (!token) return res.status(401).json({ error: 'Missing authorization token' })\r\n  const actor = await getUserFromToken(token)\r\n  if (!actor) return res.status(401).json({ error: 'Invalid token' })\r\n  if (actor.role !== 'ADMIN') return res.status(403).json({ error: 'Admin required' })\r\n\r\n  const { role } = req.body || {}\r\n  if (!role || !['ADMIN','TEAM_MEMBER'].includes(role)) return res.status(400).json({ error: 'Invalid role' })\r\n\r\n  try {\r\n    const user = await prisma.user.update({ where: { id }, data: { role } , select: { id: true, name: true, email: true, role: true }})\r\n    return res.status(200).json({ ok: true, user })\r\n  } catch (err) {\r\n    console.error('Update role error', err)\r\n    return res.status(500).json({ error: 'Failed to update role' })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,IAAI;AACJ,IAAI,CAAC,yDAAO,QAAQ,EAAE;IACpB,yDAAO,QAAQ,GAAG,IAAI,6IAAY;AACpC;AACA,SAAS,yDAAO,QAAQ;AAET,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,KAAK;IACxB,IAAI,IAAI,MAAM,KAAK,QAAQ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IAErF,MAAM,OAAO,IAAI,OAAO,EAAE,iBAAiB,IAAI,OAAO,EAAE,iBAAiB;IACzE,MAAM,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;IAC3D,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAA8B;IAC/E,MAAM,QAAQ,MAAM,IAAA,wHAAgB,EAAC;IACrC,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAgB;IACjE,IAAI,MAAM,IAAI,KAAK,SAAS,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAiB;IAElF,MAAM,EAAE,IAAI,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;IAC9B,IAAI,CAAC,QAAQ,CAAC;QAAC;QAAQ;KAAc,CAAC,QAAQ,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAe;IAE1G,IAAI;QACF,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,MAAM,CAAC;YAAE,OAAO;gBAAE;YAAG;YAAG,MAAM;gBAAE;YAAK;YAAI,QAAQ;gBAAE,IAAI;gBAAM,MAAM;gBAAM,OAAO;gBAAM,MAAM;YAAK;QAAC;QACjI,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,IAAI;YAAM;QAAK;IAC/C,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAwB;IAC/D;AACF"}}]
}