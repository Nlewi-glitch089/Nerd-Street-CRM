{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/lib/auth.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = global.__prisma || new PrismaClient()\r\nif (!global.__prisma) global.__prisma = prisma\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret'\r\nconst JWT_EXPIRES_IN = '7d'\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET)\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getUserFromToken(token) {\r\n  const data = verifyToken(token)\r\n  if (!data || !data.userId) return null\r\n  const user = await prisma.user.findUnique({ where: { id: data.userId } })\r\n  return user\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,SAAS,yDAAO,QAAQ,IAAI,IAAI,6IAAY;AAClD,IAAI,CAAC,yDAAO,QAAQ,EAAE,yDAAO,QAAQ,GAAG;AAExC,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAEhB,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACnE;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,iBAAiB,KAAK;IAC1C,MAAM,OAAO,YAAY;IACzB,IAAI,CAAC,QAAQ,CAAC,KAAK,MAAM,EAAE,OAAO;IAClC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI,KAAK,MAAM;QAAC;IAAE;IACvE,OAAO;AACT"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/pages/api/donors/index.js"],"sourcesContent":["import { getUserFromToken } from '../../../lib/auth'\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = global.__prisma || new PrismaClient()\r\nif (!global.__prisma) global.__prisma = prisma\r\n\r\nexport default async function handler(req, res) {\r\n  const auth = req.headers.authorization\r\n  const token = auth && auth.startsWith('Bearer ') ? auth.slice(7) : null\r\n  const actor = token ? await getUserFromToken(token) : null\r\n\r\n  if (!actor) return res.status(401).json({ error: 'Unauthorized' })\r\n  if (!['ADMIN','TEAM_MEMBER'].includes(actor.role)) return res.status(403).json({ error: 'Insufficient permissions' })\r\n\r\n  try {\r\n    if (req.method === 'GET') {\r\n      const list = await prisma.donor.findMany({ orderBy: { lastGiftAt: 'desc' } })\r\n      const out = list.map(d => ({ id: d.id, firstName: d.firstName, lastName: d.lastName, email: d.email, phone: d.phone, city: d.city, state: d.state, zipcode: d.zipcode, active: d.active, totalGiving: d.totalGiving, lastGiftAt: d.lastGiftAt }))\r\n      return res.status(200).json({ donors: out })\r\n    }\r\n\r\n    if (req.method === 'POST') {\r\n      const { firstName, lastName, email, phone, notes, city, state, zipcode, active } = req.body || {}\r\n      if (!firstName || !email) return res.status(400).json({ error: 'firstName and email required' })\r\n      const created = await prisma.donor.create({ data: { firstName, lastName, email, phone, notes, city, state, zipcode, active: typeof active === 'boolean' ? active : true } })\r\n      return res.status(201).json({ donor: { id: created.id, firstName: created.firstName, lastName: created.lastName, email: created.email, phone: created.phone, city: created.city, state: created.state, zipcode: created.zipcode, active: created.active, totalGiving: created.totalGiving } })\r\n    }\r\n\r\n    return res.status(405).json({ error: 'Method not allowed' })\r\n  } catch (err) {\r\n    console.error('Donors API error', err)\r\n    return res.status(500).json({ error: 'Server error', details: String(err) })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,yDAAO,QAAQ,IAAI,IAAI,6IAAY;AAClD,IAAI,CAAC,yDAAO,QAAQ,EAAE,yDAAO,QAAQ,GAAG;AAEzB,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,OAAO,IAAI,OAAO,CAAC,aAAa;IACtC,MAAM,QAAQ,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;IACnE,MAAM,QAAQ,QAAQ,MAAM,IAAA,wHAAgB,EAAC,SAAS;IAEtD,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAe;IAChE,IAAI,CAAC;QAAC;QAAQ;KAAc,CAAC,QAAQ,CAAC,MAAM,IAAI,GAAG,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAA2B;IAEnH,IAAI;QACF,IAAI,IAAI,MAAM,KAAK,OAAO;YACxB,MAAM,OAAO,MAAM,OAAO,KAAK,CAAC,QAAQ,CAAC;gBAAE,SAAS;oBAAE,YAAY;gBAAO;YAAE;YAC3E,MAAM,MAAM,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;oBAAE,IAAI,EAAE,EAAE;oBAAE,WAAW,EAAE,SAAS;oBAAE,UAAU,EAAE,QAAQ;oBAAE,OAAO,EAAE,KAAK;oBAAE,OAAO,EAAE,KAAK;oBAAE,MAAM,EAAE,IAAI;oBAAE,OAAO,EAAE,KAAK;oBAAE,SAAS,EAAE,OAAO;oBAAE,QAAQ,EAAE,MAAM;oBAAE,aAAa,EAAE,WAAW;oBAAE,YAAY,EAAE,UAAU;gBAAC,CAAC;YAC/O,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,QAAQ;YAAI;QAC5C;QAEA,IAAI,IAAI,MAAM,KAAK,QAAQ;YACzB,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM,EAAE,GAAG,IAAI,IAAI,IAAI,CAAC;YAChG,IAAI,CAAC,aAAa,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA+B;YAC9F,MAAM,UAAU,MAAM,OAAO,KAAK,CAAC,MAAM,CAAC;gBAAE,MAAM;oBAAE;oBAAW;oBAAU;oBAAO;oBAAO;oBAAO;oBAAM;oBAAO;oBAAS,QAAQ,OAAO,WAAW,YAAY,SAAS;gBAAK;YAAE;YAC1K,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;oBAAE,IAAI,QAAQ,EAAE;oBAAE,WAAW,QAAQ,SAAS;oBAAE,UAAU,QAAQ,QAAQ;oBAAE,OAAO,QAAQ,KAAK;oBAAE,OAAO,QAAQ,KAAK;oBAAE,MAAM,QAAQ,IAAI;oBAAE,OAAO,QAAQ,KAAK;oBAAE,SAAS,QAAQ,OAAO;oBAAE,QAAQ,QAAQ,MAAM;oBAAE,aAAa,QAAQ,WAAW;gBAAC;YAAE;QAC9R;QAEA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;YAAgB,SAAS,OAAO;QAAK;IAC5E;AACF"}}]
}