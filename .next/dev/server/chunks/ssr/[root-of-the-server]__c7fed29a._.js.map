{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/pages/profile.js"],"sourcesContent":["import { useEffect, useState } from 'react'\r\nimport { useRouter } from 'next/router'\r\n\r\nexport default function Profile() {\r\n  const router = useRouter()\r\n  const [loading, setLoading] = useState(true)\r\n  const [user, setUser] = useState(null)\r\n  const [error, setError] = useState(null)\r\n\r\n  useEffect(() => {\r\n    let mounted = true\r\n    ;(async () => {\r\n      try {\r\n        const token = (() => { try { return localStorage.getItem('token') } catch (e) { return null } })()\r\n        if (!token) {\r\n          if (mounted) setError('Not authenticated')\r\n          return\r\n        }\r\n        const res = await fetch('/api/protected', { headers: { Authorization: `Bearer ${token}` } })\r\n        if (!res.ok) {\r\n          if (mounted) setError('Session invalid or expired')\r\n          try { localStorage.removeItem('token') } catch (e) {}\r\n          return\r\n        }\r\n        const data = await res.json()\r\n        if (!data?.user) {\r\n          if (mounted) setError('Unable to load user')\r\n          return\r\n        }\r\n        if (mounted) setUser(data.user)\r\n      } catch (err) {\r\n        if (mounted) setError('Network error')\r\n      } finally {\r\n        if (mounted) setLoading(false)\r\n      }\r\n    })()\r\n    return () => { mounted = false }\r\n  }, [])\r\n\r\n  if (loading) return <div style={{padding:20}}>Loading...</div>\r\n  if (error) return <div style={{padding:20, color:'red'}}>{error}</div>\r\n\r\n  return (\r\n    <div style={{padding:18}}>\r\n      <div style={{display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:12}}>\r\n        <div>\r\n          <div style={{color:'var(--color-neon)', fontWeight:800, fontSize:18}}>Profile</div>\r\n          <div style={{color:'#bbb'}}>View and manage your account</div>\r\n        </div>\r\n        <div>\r\n          <button className=\"btn btn-ghost\" onClick={() => { try { router.back() } catch(e){ console.warn('nav failed', e) } }}>Back</button>\r\n          <button className=\"btn btn-ghost\" onClick={() => {\r\n            try { localStorage.removeItem('token') } catch(e) { console.warn('removeItem token failed', e) }\r\n            try { window.location.href = '/' } catch(e) { console.warn('Redirect failed', e) }\r\n          }}>Sign out</button>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{display:'grid', gridTemplateColumns:'1fr 320px', gap:18}}>\r\n        <div style={{padding:18, border:'1px solid rgba(255,255,255,0.03)', borderRadius:8}}>\r\n          <div style={{fontWeight:700, color:'var(--color-neon)', marginBottom:8}}>Account details</div>\r\n          <div style={{display:'grid', gridTemplateColumns:'140px 1fr', gap:12, alignItems:'center'}}>\r\n            <div style={{color:'#bbb'}}>Name</div>\r\n            <div style={{fontWeight:700}}>{user?.name || '—'}</div>\r\n\r\n            <div style={{color:'#bbb'}}>Email</div>\r\n            <div style={{fontWeight:700}}>{user?.email || '—'}</div>\r\n\r\n            <div style={{color:'#bbb'}}>Role</div>\r\n            <div style={{fontWeight:700}}>{user?.role || '—'}</div>\r\n\r\n            <div style={{color:'#bbb'}}>ID</div>\r\n            <div style={{fontSize:12, color:'#999'}}>{user?.id || '—'}</div>\r\n          </div>\r\n          <div style={{marginTop:14}}>\r\n            <small style={{color:'#bbb'}}>You can update your display name or change your password below.</small>\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{padding:18, border:'1px solid rgba(255,255,255,0.03)', borderRadius:8}}>\r\n          <div style={{fontWeight:700, color:'var(--color-neon)', marginBottom:8}}>Edit profile</div>\r\n          <ProfileEditor initialName={user?.name} />\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{marginTop:18, padding:18, border:'1px solid rgba(255,255,255,0.03)', borderRadius:8}}>\r\n        <div style={{fontWeight:700, color:'var(--color-neon)', marginBottom:8}}>Recent activity</div>\r\n        <RecentActivityList />\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction RecentActivityList(){\r\n  // lightweight local sample; try server seed if available\r\n  const [items, setItems] = useState([])\r\n  useEffect(()=>{\r\n    let mounted = true\r\n    ;(async()=>{\r\n      try{\r\n        const token = (()=>{ try{ return localStorage.getItem('token') }catch(e){return null} })()\r\n        const res = await fetch('/api/seed', { method: 'POST', headers: { 'Content-Type':'application/json', ...(token?{ Authorization:`Bearer ${token}` }:{} ) }})\r\n        if (res.ok){ const d = await res.json().catch(()=>null); if (mounted) setItems(d.recentActivity || []) }\r\n        else if (mounted) setItems([{ id:'r1', title:'No recent server activity', note:'No items returned' }])\r\n      }catch(e){ if (mounted) setItems([{ id:'r2', title:'Local sample activity', note:'Nothing to show from server' }]) }\r\n    })()\r\n    return ()=>{ mounted=false }\r\n  },[])\r\n  if (!items || items.length === 0) return <div style={{color:'#888'}}>No recent activity</div>\r\n  return (\r\n    <div style={{display:'flex', flexDirection:'column', gap:10}}>\r\n      {items.map((r,i)=> (\r\n        <div key={r.id || i} style={{padding:10, border:'1px solid rgba(255,255,255,0.03)', borderRadius:6}}>\r\n          <div style={{fontWeight:700}}>{r.title || r.partner || r.title}</div>\r\n          <div style={{fontSize:13, color:'#bbb'}}>{r.note || r.kind || ''}</div>\r\n          <div style={{fontSize:12, color:'#999', marginTop:6}}>{r.date || ''}</div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction ProfileEditor({ initialName }){\r\n  const [name, setName] = useState(initialName || '')\r\n  const [password, setPassword] = useState('')\r\n  const [confirm, setConfirm] = useState('')\r\n  const [loading, setLoading] = useState(false)\r\n  const [message, setMessage] = useState(null)\r\n\r\n  async function submit(e){\r\n    if (e && e.preventDefault) e.preventDefault()\r\n    setMessage(null)\r\n    if (password && password.length < 8) return setMessage({ type:'error', text: 'Password must be at least 8 characters' })\r\n    if (password && password !== confirm) return setMessage({ type:'error', text: 'Password and confirmation do not match' })\r\n    setLoading(true)\r\n    try{\r\n      const token = (()=>{ try{ return localStorage.getItem('token') }catch(e){return null} })()\r\n      const body = { name: name || undefined }\r\n      if (password) body.password = password\r\n      const res = await fetch('/api/auth/update', { method: 'POST', headers: { 'Content-Type':'application/json', ...(token?{ Authorization:`Bearer ${token}` }:{} ) }, body: JSON.stringify(body) })\r\n      const d = await res.json().catch(()=>null)\r\n      if (!res.ok) throw new Error(d?.error || 'Update failed')\r\n      setMessage({ type:'success', text: 'Profile updated' })\r\n      setPassword(''); setConfirm('')\r\n    }catch(err){ setMessage({ type:'error', text: String(err.message || err) }) }\r\n    finally{ setLoading(false) }\r\n  }\r\n\r\n  return (\r\n    <form onSubmit={submit}>\r\n      <div style={{display:'grid', gap:8}}>\r\n        <label style={{fontSize:12, color:'#bbb'}}>Display name</label>\r\n        <input className=\"input\" value={name} onChange={e=>setName(e.target.value)} placeholder=\"Your name\" />\r\n\r\n        <label style={{fontSize:12, color:'#bbb', marginTop:8}}>New password</label>\r\n        <input className=\"input\" type=\"password\" value={password} onChange={e=>setPassword(e.target.value)} placeholder=\"Leave blank to keep current\" />\r\n\r\n        <label style={{fontSize:12, color:'#bbb'}}>Confirm password</label>\r\n        <input className=\"input\" type=\"password\" value={confirm} onChange={e=>setConfirm(e.target.value)} placeholder=\"Confirm new password\" />\r\n\r\n        <div style={{display:'flex', gap:8, justifyContent:'flex-end', marginTop:8}}>\r\n          <button className=\"btn btn-ghost\" type=\"button\" onClick={()=>{ setName(initialName || ''); setPassword(''); setConfirm(''); setMessage(null) }}>Reset</button>\r\n          <button className=\"btn\" type=\"submit\" disabled={loading}>{loading? 'Saving...' : 'Save changes'}</button>\r\n        </div>\r\n\r\n        {message && <div style={{marginTop:8, color: message.type === 'error' ? '#ff8080' : 'var(--color-neon)'}}>{message.text}</div>}\r\n      </div>\r\n    </form>\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}