{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/lib/auth.js"],"sourcesContent":["import jwt from 'jsonwebtoken'\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = global.__prisma || new PrismaClient()\r\nif (!global.__prisma) global.__prisma = prisma\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || 'dev-secret'\r\nconst JWT_EXPIRES_IN = '7d'\r\n\r\nexport function signToken(payload) {\r\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: JWT_EXPIRES_IN })\r\n}\r\n\r\nexport function verifyToken(token) {\r\n  try {\r\n    return jwt.verify(token, JWT_SECRET)\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getUserFromToken(token) {\r\n  const data = verifyToken(token)\r\n  if (!data || !data.userId) return null\r\n  const user = await prisma.user.findUnique({ where: { id: data.userId } })\r\n  return user\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,SAAS,yDAAO,QAAQ,IAAI,IAAI,6IAAY;AAClD,IAAI,CAAC,yDAAO,QAAQ,EAAE,yDAAO,QAAQ,GAAG;AAExC,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,iBAAiB;AAEhB,SAAS,UAAU,OAAO;IAC/B,OAAO,4HAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAe;AACnE;AAEO,SAAS,YAAY,KAAK;IAC/B,IAAI;QACF,OAAO,4HAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,KAAK;QACZ,OAAO;IACT;AACF;AAEO,eAAe,iBAAiB,KAAK;IAC1C,MAAM,OAAO,YAAY;IACzB,IAAI,CAAC,QAAQ,CAAC,KAAK,MAAM,EAAE,OAAO;IAClC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;QAAE,OAAO;YAAE,IAAI,KAAK,MAAM;QAAC;IAAE;IACvE,OAAO;AACT"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/pages/api/donors/%5Bid%5D.js"],"sourcesContent":["import { getUserFromToken } from '../../../lib/auth'\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst prisma = global.__prisma || new PrismaClient()\r\nif (!global.__prisma) global.__prisma = prisma\r\n\r\nexport default async function handler(req, res) {\r\n  const { id } = req.query\r\n  if (!id) return res.status(400).json({ error: 'Missing donor id' })\r\n\r\n  if (req.method !== 'GET') return res.status(405).json({ error: 'Method not allowed' })\r\n\r\n  try {\r\n    const auth = req.headers.authorization\r\n    const token = auth && auth.startsWith('Bearer ') ? auth.slice(7) : null\r\n    const actor = token ? await getUserFromToken(token) : null\r\n    if (!actor) return res.status(401).json({ error: 'Unauthorized' })\r\n    // allow ADMIN and TEAM_MEMBER to view donor details\r\n    if (!['ADMIN','TEAM_MEMBER'].includes(actor.role)) return res.status(403).json({ error: 'Insufficient permissions' })\r\n\r\n    const donor = await prisma.donor.findUnique({\r\n      where: { id: String(id) },\r\n      include: { donations: { orderBy: { date: 'desc' } } }\r\n    })\r\n    if (!donor) return res.status(404).json({ error: 'Donor not found' })\r\n\r\n    // format donations for client (include method + notes)\r\n    const donations = (donor.donations || []).map(d => ({ id: d.id, amount: d.amount, date: d.date, campaignId: d.campaignId, method: d.method || null, notes: d.notes || null }))\r\n\r\n    return res.status(200).json({ donor: { id: donor.id, firstName: donor.firstName, lastName: donor.lastName, email: donor.email, phone: donor.phone, city: donor.city, state: donor.state, zipcode: donor.zipcode, active: donor.active, notes: donor.notes, totalGiving: donor.totalGiving, lastGiftAt: donor.lastGiftAt }, donations })\r\n  } catch (err) {\r\n    console.error('Donor detail error', err)\r\n    return res.status(500).json({ error: 'Server error', details: String(err) })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,yDAAO,QAAQ,IAAI,IAAI,6IAAY;AAClD,IAAI,CAAC,yDAAO,QAAQ,EAAE,yDAAO,QAAQ,GAAG;AAEzB,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,MAAM,EAAE,EAAE,EAAE,GAAG,IAAI,KAAK;IACxB,IAAI,CAAC,IAAI,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAmB;IAEjE,IAAI,IAAI,MAAM,KAAK,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IAEpF,IAAI;QACF,MAAM,OAAO,IAAI,OAAO,CAAC,aAAa;QACtC,MAAM,QAAQ,QAAQ,KAAK,UAAU,CAAC,aAAa,KAAK,KAAK,CAAC,KAAK;QACnE,MAAM,QAAQ,QAAQ,MAAM,IAAA,wHAAgB,EAAC,SAAS;QACtD,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;QAChE,oDAAoD;QACpD,IAAI,CAAC;YAAC;YAAQ;SAAc,CAAC,QAAQ,CAAC,MAAM,IAAI,GAAG,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA2B;QAEnH,MAAM,QAAQ,MAAM,OAAO,KAAK,CAAC,UAAU,CAAC;YAC1C,OAAO;gBAAE,IAAI,OAAO;YAAI;YACxB,SAAS;gBAAE,WAAW;oBAAE,SAAS;wBAAE,MAAM;oBAAO;gBAAE;YAAE;QACtD;QACA,IAAI,CAAC,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAkB;QAEnE,uDAAuD;QACvD,MAAM,YAAY,CAAC,MAAM,SAAS,IAAI,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,CAAC;gBAAE,IAAI,EAAE,EAAE;gBAAE,QAAQ,EAAE,MAAM;gBAAE,MAAM,EAAE,IAAI;gBAAE,YAAY,EAAE,UAAU;gBAAE,QAAQ,EAAE,MAAM,IAAI;gBAAM,OAAO,EAAE,KAAK,IAAI;YAAK,CAAC;QAE5K,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;gBAAE,IAAI,MAAM,EAAE;gBAAE,WAAW,MAAM,SAAS;gBAAE,UAAU,MAAM,QAAQ;gBAAE,OAAO,MAAM,KAAK;gBAAE,OAAO,MAAM,KAAK;gBAAE,MAAM,MAAM,IAAI;gBAAE,OAAO,MAAM,KAAK;gBAAE,SAAS,MAAM,OAAO;gBAAE,QAAQ,MAAM,MAAM;gBAAE,OAAO,MAAM,KAAK;gBAAE,aAAa,MAAM,WAAW;gBAAE,YAAY,MAAM,UAAU;YAAC;YAAG;QAAU;IACvU,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;YAAgB,SAAS,OAAO;QAAK;IAC5E;AACF"}}]
}