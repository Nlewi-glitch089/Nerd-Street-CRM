{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Launchpad8/Nerd-Street-CRM/pages/api/campaigns/index.js"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nlet prisma\r\nif (!global.__prisma) {\r\n  global.__prisma = new PrismaClient()\r\n}\r\nprisma = global.__prisma\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'GET') return res.status(405).json({ error: 'Method not allowed' })\r\n  try {\r\n    const campaigns = await prisma.campaign.findMany({ include: { donations: true } })\r\n    // helper to detect gift-like donations (notes may include 'gift' or similar)\r\n    const isGift = (d) => {\r\n      try {\r\n        const m = String(d.method || '').toLowerCase()\r\n        const n = String(d.notes || '').toLowerCase()\r\n        return /gift/.test(m) || /gift/.test(n)\r\n      } catch (e) { return false }\r\n    }\r\n\r\n    const list = campaigns.map(c => {\r\n      const raised = c.donations.reduce((s,d)=>s + (Number(d.amount||0) || 0), 0)\r\n      const giftedRaised = c.donations.filter(isGift).reduce((s,d)=>s + (Number(d.amount||0) || 0), 0)\r\n      // Treat campaigns with funds as implicitly approved for UI display\r\n      const impliedApproved = raised > 0\r\n      return { id: c.id, name: c.name, goal: c.goal, raised, giftedRaised, approved: !!c.approved || impliedApproved }\r\n    })\r\n    return res.status(200).json({ campaigns: list })\r\n  } catch (err) {\r\n    console.error('Campaigns API error', err)\r\n    return res.status(500).json({ error: 'Failed to list campaigns' })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI;AACJ,IAAI,CAAC,yDAAO,QAAQ,EAAE;IACpB,yDAAO,QAAQ,GAAG,IAAI,6IAAY;AACpC;AACA,SAAS,yDAAO,QAAQ;AAET,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;QAAE,OAAO;IAAqB;IACpF,IAAI;QACF,MAAM,YAAY,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC;YAAE,SAAS;gBAAE,WAAW;YAAK;QAAE;QAChF,6EAA6E;QAC7E,MAAM,SAAS,CAAC;YACd,IAAI;gBACF,MAAM,IAAI,OAAO,EAAE,MAAM,IAAI,IAAI,WAAW;gBAC5C,MAAM,IAAI,OAAO,EAAE,KAAK,IAAI,IAAI,WAAW;gBAC3C,OAAO,OAAO,IAAI,CAAC,MAAM,OAAO,IAAI,CAAC;YACvC,EAAE,OAAO,GAAG;gBAAE,OAAO;YAAM;QAC7B;QAEA,MAAM,OAAO,UAAU,GAAG,CAAC,CAAA;YACzB,MAAM,SAAS,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC,GAAE,IAAI,IAAI,CAAC,OAAO,EAAE,MAAM,IAAE,MAAM,CAAC,GAAG;YACzE,MAAM,eAAe,EAAE,SAAS,CAAC,MAAM,CAAC,QAAQ,MAAM,CAAC,CAAC,GAAE,IAAI,IAAI,CAAC,OAAO,EAAE,MAAM,IAAE,MAAM,CAAC,GAAG;YAC9F,mEAAmE;YACnE,MAAM,kBAAkB,SAAS;YACjC,OAAO;gBAAE,IAAI,EAAE,EAAE;gBAAE,MAAM,EAAE,IAAI;gBAAE,MAAM,EAAE,IAAI;gBAAE;gBAAQ;gBAAc,UAAU,CAAC,CAAC,EAAE,QAAQ,IAAI;YAAgB;QACjH;QACA,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,WAAW;QAAK;IAChD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA2B;IAClE;AACF"}}]
}