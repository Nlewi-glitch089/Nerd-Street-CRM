module.exports=[50852,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},40175,(a,b,c)=>{"use strict";b.exports=a.r(1951).vendored.contexts.HeadManagerContext},42939,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},2093,(a,b,c)=>{b.exports=a.x("styled-jsx/style.js",()=>require("styled-jsx/style.js"))},1615,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(27342),g=a.i(8171),h=a.i(2093),i=a.i(27669),j=a.i(41910);function k(){let a=(0,j.useRouter)(),[b,c]=(0,i.useState)(!0),[d,e]=(0,i.useState)(null),[f,k]=(0,i.useState)(null);return((0,i.useEffect)(()=>{let a=!0;return(async()=>{try{let b=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})();if(!b){a&&k("Not authenticated");return}let c=await fetch("/api/protected",{headers:{Authorization:`Bearer ${b}`}});if(!c.ok){a&&k("Session invalid or expired");try{localStorage.removeItem("token")}catch(a){}return}let d=await c.json();if(!d?.user){a&&k("Unable to load user");return}a&&e(d.user)}catch(b){a&&k("Network error")}finally{a&&c(!1)}})(),()=>{a=!1}},[]),b)?(0,g.jsxs)("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"#000",zIndex:9999},className:"jsx-236c8c664276c327",children:[(0,g.jsxs)("div",{style:{textAlign:"center",transform:"translateY(-6%)"},className:"jsx-236c8c664276c327",children:[(0,g.jsx)("div",{className:"jsx-236c8c664276c327 spinner"}),(0,g.jsx)("div",{style:{color:"#bbb",marginTop:14,fontSize:16},className:"jsx-236c8c664276c327",children:"Loading profile..."})]}),(0,g.jsx)(h.default,{id:"236c8c664276c327",children:".spinner.jsx-236c8c664276c327{border:8px solid #ffffff08;border-top-color:#39ff14;border-radius:50%;width:88px;height:88px;margin:0 auto;animation:1s linear infinite spin;box-shadow:0 0 28px #39ff1414}@keyframes spin{to{transform:rotate(360deg)}}"})]}):f?(0,g.jsx)("div",{style:{padding:20,color:"red"},children:f}):(0,g.jsxs)("div",{style:{padding:18},children:[(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{style:{color:"var(--color-neon)",fontWeight:800,fontSize:18},children:"Profile"}),(0,g.jsx)("div",{style:{color:"#bbb"},children:"View and manage your account"})]}),(0,g.jsxs)("div",{style:{display:"flex",gap:12},children:[(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>{try{a.back()}catch(a){console.warn("nav failed",a)}},children:"Back"}),(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>{try{localStorage.removeItem("token")}catch(a){console.warn("removeItem token failed",a)}try{window.location.href="/"}catch(a){console.warn("Redirect failed",a)}},children:"Sign out"})]})]}),(0,g.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px",gap:18},children:[(0,g.jsx)("div",{style:{padding:18,border:"1px solid rgba(255,255,255,0.03)",borderRadius:8},children:(0,g.jsxs)("div",{style:{maxWidth:640},children:[(0,g.jsx)("div",{style:{fontWeight:700,color:"var(--color-neon)",marginBottom:8},children:"Account details"}),(0,g.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"140px 1fr",gap:12,alignItems:"center"},children:[(0,g.jsx)("div",{style:{color:"#bbb"},children:"Name"}),(0,g.jsx)("div",{style:{fontWeight:700},children:d?.name||"—"}),(0,g.jsx)("div",{style:{color:"#bbb"},children:"Email"}),(0,g.jsx)("div",{style:{fontWeight:700},children:d?.email||"—"}),(0,g.jsx)("div",{style:{color:"#bbb"},children:"Role"}),(0,g.jsx)("div",{style:{fontWeight:700},children:d?.role||"—"}),(0,g.jsx)("div",{style:{color:"#bbb"},children:"ID"}),(0,g.jsx)("div",{style:{fontSize:12,color:"#999"},children:d?.id||"—"})]}),(0,g.jsx)(n,{userEmail:d?.email})]})}),(0,g.jsxs)("div",{style:{padding:18,border:"1px solid rgba(255,255,255,0.03)",borderRadius:8},children:[(0,g.jsx)("div",{style:{fontWeight:700,color:"var(--color-neon)",marginBottom:8},children:"Edit profile"}),(0,g.jsx)("div",{style:{color:"#bbb",marginBottom:10,fontSize:13},children:"Update your display name or change your password using the form on this panel."}),(0,g.jsx)(m,{initialName:d?.name})]})]}),(0,g.jsxs)("div",{style:{marginTop:18,padding:18,border:"1px solid rgba(255,255,255,0.03)",borderRadius:8},children:[(0,g.jsx)("div",{style:{fontWeight:700,color:"var(--color-neon)",marginBottom:8},children:"Recent activity"}),(0,g.jsx)(l,{})]})]})}function l(){let[a,b]=(0,i.useState)([]),[c,d]=(0,i.useState)(!0),[e,f]=(0,i.useState)(!1),h="seed_recent_activity";return((0,i.useEffect)(()=>{let a=!0;return(async()=>{d(!0);try{let c=localStorage.getItem(h);if(c){let e=JSON.parse(c);e&&e.items&&e.ts&&Date.now()-e.ts<=3e5&&a&&(b(e.items),f(!0),d(!1))}}catch(a){}let c=new AbortController,g=setTimeout(()=>c.abort(),6e3);try{let d=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})(),g=await fetch("/api/seed",{method:"POST",headers:{"Content-Type":"application/json",...d?{Authorization:`Bearer ${d}`}:{}},signal:c.signal});if(g.ok){let c=await g.json().catch(()=>null);if(a){let a=c?.recentActivity||[];b(a),f(!1);try{localStorage.setItem(h,JSON.stringify({items:a,ts:Date.now()}))}catch(a){}}}else a&&!e&&b([{id:"r1",title:"No recent server activity",note:"No items returned"}])}catch(c){a&&!e&&b([{id:"r2",title:"Local sample activity",note:"Nothing to show from server"}])}finally{clearTimeout(g),a&&d(!1)}})(),()=>{a=!1}},[]),c&&!e)?(0,g.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[1,2,3].map(a=>(0,g.jsx)("div",{style:{height:56,borderRadius:6,background:"linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))",border:"1px solid rgba(255,255,255,0.02)"}},a))}):a&&0!==a.length?(0,g.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:10},children:[e&&(0,g.jsx)("div",{style:{fontSize:12,color:"#999"},children:"Showing cached activity — updating..."}),a.map((a,b)=>(0,g.jsxs)("div",{style:{padding:10,border:"1px solid rgba(255,255,255,0.03)",borderRadius:6},children:[(0,g.jsx)("div",{style:{fontWeight:700},children:a.title||a.partner||a.title}),(0,g.jsx)("div",{style:{fontSize:13,color:"#bbb"},children:a.note||a.kind||""}),(0,g.jsx)("div",{style:{fontSize:12,color:"#999",marginTop:6},children:a.date||""})]},a.id||b))]}):(0,g.jsx)("div",{style:{color:"#888"},children:"No recent activity"})}function m({initialName:a}){let[b,c]=(0,i.useState)(a||""),[d,e]=(0,i.useState)(""),[f,h]=(0,i.useState)(""),[j,k]=(0,i.useState)(!1),[l,m]=(0,i.useState)(null);async function n(a){if(a&&a.preventDefault&&a.preventDefault(),m(null),d&&d.length<8)return m({type:"error",text:"Password must be at least 8 characters"});if(d&&d!==f)return m({type:"error",text:"Password and confirmation do not match"});k(!0);try{let a=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})(),c={name:b||void 0};d&&(c.password=d);let f=await fetch("/api/auth/update",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(c)}),g=await f.json().catch(()=>null);if(!f.ok)throw Error(g?.error||"Update failed");m({type:"success",text:"Profile updated"}),e(""),h("")}catch(a){m({type:"error",text:String(a.message||a)})}finally{k(!1)}}return(0,g.jsx)("form",{onSubmit:n,children:(0,g.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Display name"}),(0,g.jsx)("input",{className:"input",value:b,onChange:a=>c(a.target.value),placeholder:"Your name",autoComplete:"name"}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb",marginTop:8},children:"New password"}),(0,g.jsx)("input",{className:"input",type:"password",value:d,onChange:a=>e(a.target.value),placeholder:"Leave blank to keep current",autoComplete:"new-password"}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Confirm password"}),(0,g.jsx)("input",{className:"input",type:"password",value:f,onChange:a=>h(a.target.value),placeholder:"Confirm new password",autoComplete:"new-password"}),(0,g.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:8},children:[(0,g.jsx)("button",{className:"btn btn-ghost",type:"button",onClick:()=>{c(a||""),e(""),h(""),m(null)},children:"Reset"}),(0,g.jsx)("button",{className:"btn",type:"submit",disabled:j,children:j?"Saving...":"Save changes"})]}),l&&(0,g.jsx)("div",{style:{marginTop:8,color:"error"===l.type?"#ff8080":"var(--color-neon)"},children:l.text})]})})}function n({userEmail:a}){let[b,c]=(0,i.useState)(!1),[d,e]=(0,i.useState)("This partner only"),[f,h]=(0,i.useState)(""),[j,k]=(0,i.useState)(!1),[l,m]=(0,i.useState)(null);async function n(b){if(b&&b.preventDefault&&b.preventDefault(),m(null),!d)return m({type:"error",text:"Please choose a scope"});k(!0);try{let b=await fetch("/api/admin/request-access",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,scope:d,note:f})}),e=await b.json().catch(()=>null);if(!b.ok)throw Error(e?.error||"Request failed");m({type:"success",text:e?.message||"Request sent"}),c(!1),h("")}catch(a){m({type:"error",text:String(a.message||a)})}finally{k(!1)}}return(0,g.jsxs)("div",{style:{marginTop:12},children:[(0,g.jsx)("div",{style:{fontSize:12,color:"#bbb",marginBottom:8},children:"Need temporary, limited admin access for a specific task? Request it here."}),b?(0,g.jsxs)("form",{onSubmit:n,style:{display:"grid",gap:8},children:[(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Scope"}),(0,g.jsxs)("select",{value:d,onChange:a=>e(a.target.value),style:{padding:8,borderRadius:6,background:"#0b0b0b",color:"#eee",border:"1px solid rgba(255,255,255,0.03)"},children:[(0,g.jsx)("option",{children:"This partner only"}),(0,g.jsx)("option",{children:"This campaign only"}),(0,g.jsx)("option",{children:"Specific tasks only"})]}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Reason / details"}),(0,g.jsx)("textarea",{value:f,onChange:a=>h(a.target.value),placeholder:"Why do you need temporary access?",rows:3,style:{padding:8,borderRadius:6,background:"#0b0b0b",color:"#eee",border:"1px solid rgba(255,255,255,0.03)"}}),(0,g.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,g.jsx)("button",{type:"button",className:"btn btn-ghost",onClick:()=>{c(!1),h(""),m(null)},children:"Cancel"}),(0,g.jsx)("button",{className:"btn",type:"submit",disabled:j,children:j?"Sending...":"Send request"})]})]}):(0,g.jsx)("div",{style:{display:"flex",gap:8},children:(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>c(!0),children:"Request Temporary Access"})}),l&&(0,g.jsx)("div",{style:{marginTop:8,color:"error"===l.type?"#ff8080":"var(--color-neon)"},children:l.text})]})}a.s(["default",()=>k],86530);var o=a.i(86530),p=a.i(9193);let q=(0,d.hoist)(o,"default"),r=(0,d.hoist)(o,"getStaticProps"),s=(0,d.hoist)(o,"getStaticPaths"),t=(0,d.hoist)(o,"getServerSideProps"),u=(0,d.hoist)(o,"config"),v=(0,d.hoist)(o,"reportWebVitals"),w=(0,d.hoist)(o,"unstable_getStaticProps"),x=(0,d.hoist)(o,"unstable_getStaticPaths"),y=(0,d.hoist)(o,"unstable_getStaticParams"),z=(0,d.hoist)(o,"unstable_getServerProps"),A=(0,d.hoist)(o,"unstable_getServerSideProps"),B=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/profile",pathname:"/profile",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:o}),C=(0,p.getHandler)({srcPage:"/profile",config:u,userland:o,routeModule:B,getStaticPaths:s,getStaticProps:r,getServerSideProps:t});a.s(["config",0,u,"default",0,q,"getServerSideProps",0,t,"getStaticPaths",0,s,"getStaticProps",0,r,"handler",0,C,"reportWebVitals",0,v,"routeModule",0,B,"unstable_getServerProps",0,z,"unstable_getServerSideProps",0,A,"unstable_getStaticParams",0,y,"unstable_getStaticPaths",0,x,"unstable_getStaticProps",0,w],1615)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a021c9ae._.js.map