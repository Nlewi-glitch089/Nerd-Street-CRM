module.exports=[83519,a=>{"use strict";var b=a.i(79168),c=a.i(27068),d=a.i(32759),e=a.i(39141),f=a.i(27342),g=a.i(8171),h=a.i(27669),i=a.i(41910);function j(){let a=(0,i.useRouter)(),[b,c]=(0,h.useState)(!0),[d,e]=(0,h.useState)(null),[f,j]=(0,h.useState)(null),[k,l]=(0,h.useState)([]),[m,n]=(0,h.useState)([]),[o,p]=(0,h.useState)({firstName:"",lastName:"",email:"",phone:""}),[q,r]=(0,h.useState)(!1),[s,t]=(0,h.useState)(null),[u,v]=(0,h.useState)(!1),[w,x]=(0,h.useState)(""),[y,z]=(0,h.useState)({amount:"",campaignId:"",method:"CASH",methodDetail:"",notes:""}),[A,B]=(0,h.useState)(null),[C,D]=(0,h.useState)(null);function E(a){let b=Date.now(),c=(a,b)=>Math.round(Math.random()*(b-a)+a),d=[],e=c(2,6);for(let f=0;f<e;f++){let e=c(20,5e3);d.push({id:`sample-d-${a}-${f}`,donorId:a,amount:e,date:new Date(b-864e5*f*c(5,30)).toISOString(),campaignId:f%2==0?"sample-c-1":"sample-c-2",method:f%3==0?"CARD":"CASH",notes:f%4==0?"gift":""})}return d.sort((a,b)=>new Date(b.date)-new Date(a.date))}function F(){return[["Nate","Marshall"],["Evelyn","Hart"],["Jamal","Reyes"],["Lila","Kim"],["Owen","Park"],["Maya","Singh"],["Alex","Chen"],["Sofia","Diaz"],["Ryan","West"],["Zoe","Ng"]].map((a,b)=>{let c=`sample-${b+1}`,d=E(c),e=d.reduce((a,b)=>a+Number(b.amount||0),0),f=d.filter(a=>String(a.notes||"").toLowerCase().includes("gift")).reduce((a,b)=>a+Number(b.amount||0),0);return{id:c,firstName:a[0],lastName:a[1],email:`${a[0].toLowerCase()}.${a[1].toLowerCase()}@example.org`,phone:"555-010"+(b+1).toString().padStart(2,"0"),totalGiving:e,giftedTotal:f,donations:d}})}async function G(a){try{let b=a=>{try{let b=String(a.method||"").toLowerCase(),c=String(a.notes||"").toLowerCase();return/gift/.test(b)||/gift/.test(c)}catch(a){return!1}};try{let c=await fetch(`/api/donors/${a.id}`);if(!c.ok)throw Error("no-server");let d=await c.json(),e=d.donations||[],f=(e||[]).reduce((a,b)=>a+(Number(b.amount||0)||0),0),g=(e||[]).filter(b).reduce((a,b)=>a+(Number(b.amount||0)||0),0),h=e&&e.length>0?e[0].date||e[e.length-1].date:null;B({donor:d.donor||a,totalGiving:f,giftedTotal:g,gifts:e.length,lastGiftAt:h,donations:e});return}catch(c){try{let c=F().find(b=>b.id===a.id)||null,d=c?c.donations:E(a.id||"local"),e=(d||[]).reduce((a,b)=>a+(Number(b.amount||0)||0),0),f=(d||[]).filter(b).reduce((a,b)=>a+(Number(b.amount||0)||0),0),g=d&&d.length>0?d[0].date:null;B({donor:{...a,email:a.email||`${a.firstName||"user"}.sample@example.org`},totalGiving:e,giftedTotal:f,gifts:d.length,lastGiftAt:g,donations:d});return}catch(a){throw a}}}catch(b){console.warn(b),B({donor:a,error:"Preview failed"})}}function H(a,b){if(!b||""===b.trim())return a;let c=b.toLowerCase();return 1===c.length?a.filter(a=>{let b=(a.firstName||"").toLowerCase(),d=(a.lastName||"").toLowerCase(),e=(a.email||"").toLowerCase();return b.startsWith(c)||d.startsWith(c)||e.startsWith(c)}):a.filter(a=>{let b=((a.firstName||"")+" "+(a.lastName||"")).toLowerCase(),d=(a.email||"").toLowerCase();return b.includes(c)||d.includes(c)})}async function I(){try{let a=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})(),b=await fetch("/api/donors",{headers:{...a?{Authorization:`Bearer ${a}`}:{}}});if(!b.ok)return;let c=(await b.json()).donors||[];if(!c||0===c.length){try{if((await fetch("/api/seed",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}})).ok){let b=await fetch("/api/donors",{headers:{...a?{Authorization:`Bearer ${a}`}:{}}});if(b.ok){let a=await b.json();l(a.donors||[]);return}}}catch(a){console.warn("Auto-seed donors failed",a)}try{let a=F();l(a),n([{id:"sample-c-1",name:"Spring Fundraiser 2025",goal:75e3,raised:12e3,giftedRaised:2e3,approved:!0},{id:"sample-c-2",name:"Community Outreach Q2",goal:2e4,raised:5e3,giftedRaised:800,approved:!1},{id:"sample-c-3",name:"Scholarship Drive",goal:3e4,raised:15e3,giftedRaised:3e3,approved:!0},{id:"sample-c-4",name:"Winter Relief 2025",goal:4e4,raised:22e3,giftedRaised:5e3,approved:!0}]);return}catch(a){console.warn("Local sample donors failed",a)}l([]);return}try{let b=await fetch("/api/analytics");if(b.ok){let d=await b.json();if(!d||!Array.isArray(d.donorStats)||0===d.donorStats.length)try{if((await fetch("/api/seed",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}})).ok){let a=await fetch("/api/analytics");if(a.ok){let b=((await a.json()).donorStats||[]).reduce((a,b)=>(a[b.id]=b,a),{}),d=c.map(a=>({...a,giftedTotal:b[a.id]&&(b[a.id].giftedTotal||b[a.id].gifted)||0}));l(d);return}}}catch(a){console.warn("Auto-seed analytics failed",a)}let e=(d.donorStats||[]).reduce((a,b)=>(a[b.id]=b,a),{}),f=c.map(a=>({...a,giftedTotal:e[a.id]&&(e[a.id].giftedTotal||e[a.id].gifted)||0}));l(f)}else l(c)}catch(a){console.warn("Enrich donors failed",a),l(c)}}catch(a){console.warn(a)}}async function J(){try{let a=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})(),b=await fetch("/api/campaigns");if(!b.ok)return;let c=(await b.json()).campaigns||[];if(!c||0===c.length){try{if((await fetch("/api/seed",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}}})).ok){let a=await fetch("/api/campaigns");if(a.ok){let b=await a.json();n(b.campaigns||[]);return}}}catch(a){console.warn("Auto-seed campaigns failed",a)}n([]);return}n(c)}catch(a){console.warn(a)}}return((0,h.useEffect)(()=>{let a=!0;return(async()=>{try{let a=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})();if(!a){e("Not authenticated"),c(!1);return}let b=await fetch("/api/protected",{headers:{Authorization:`Bearer ${a}`}});if(!b.ok){e("Session invalid"),c(!1);return}let d=await b.json();if(!d?.user){e("Unable to load user"),c(!1);return}j(d.user),await I(),await J()}catch(a){console.warn(a),e("Network error")}finally{a&&c(!1)}})(),()=>{a=!1}},[]),b)?(0,g.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"var(--color-black, #000)"},children:(0,g.jsxs)("div",{style:{textAlign:"center",color:"var(--color-neon, #39ff14)"},children:[(0,g.jsx)("div",{style:{width:92,height:92,borderRadius:46,border:"6px solid rgba(57,255,20,0.12)",borderTopColor:"var(--color-neon, #39ff14)",animation:"spin 1s linear infinite",margin:"0 auto 18px"}}),(0,g.jsx)("div",{children:"Loading donors..."}),(0,g.jsx)("style",{children:"@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}"})]})}):d?(0,g.jsx)("div",{style:{padding:24,color:"#ff8080"},children:d}):(0,g.jsxs)("div",{style:{padding:20},children:[(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,g.jsx)("h2",{style:{color:"var(--color-neon)"},children:"Donors"}),(0,g.jsx)("div",{children:(0,g.jsx)("button",{className:"btn",onClick:()=>a.push("/admin"),children:"Back"})})]}),(0,g.jsxs)("section",{style:{marginTop:12,display:"grid",gridTemplateColumns:"1fr 320px",gap:20},children:[(0,g.jsx)("div",{children:(0,g.jsxs)("div",{style:{border:"1px solid rgba(255,255,255,0.03)",padding:12,borderRadius:8},children:[(0,g.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,g.jsx)("div",{style:{fontWeight:700},children:"All Donors"}),(0,g.jsx)("div",{style:{width:320},children:(0,g.jsx)("input",{className:"input",placeholder:"Filter by name or email",value:w,onChange:a=>x(a.target.value)})})]}),(0,g.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:0===H(k,w).length?(0,g.jsx)("div",{style:{color:"#888"},children:"No donors match your search"}):H(k,w).map(a=>(0,g.jsxs)("div",{style:{padding:10,borderBottom:"1px solid rgba(255,255,255,0.02)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{style:{fontWeight:700},children:[a.firstName," ",a.lastName||""]}),(0,g.jsxs)("div",{style:{fontSize:12,color:"#bbb"},children:[a.email," — $",a.totalGiving||0,void 0!==a.giftedTotal&&(0,g.jsx)("span",{style:{marginLeft:8,color:"#9be"},children:`(gifts: $${a.giftedTotal})`})]})]}),(0,g.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,g.jsx)("button",{className:"btn",onClick:()=>{t({donor:a}),z({amount:"",campaignId:"",method:"CASH",methodDetail:"",notes:""})},children:"Record Donation"}),(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>G(a),children:"View"})]})]},a.id))})]})}),(0,g.jsx)("aside",{children:(0,g.jsxs)("div",{style:{border:"1px solid rgba(255,255,255,0.03)",padding:12,borderRadius:8},children:[(0,g.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Add New Donor"}),(0,g.jsx)("div",{style:{marginTop:8},children:(0,g.jsx)("button",{className:"btn btn-primary",onClick:()=>a.push("/admin/donors/new"),children:"Add Donor"})})]})})]}),s&&(0,g.jsx)("div",{className:"dialog-backdrop",children:(0,g.jsxs)("div",{style:{width:520,background:"var(--color-off-black)",border:"1px solid rgba(255,255,255,0.04)",padding:18,borderRadius:8},children:[(0,g.jsxs)("h3",{style:{color:"var(--color-neon)"},children:["Record Donation for ",s.donor.firstName," ",s.donor.lastName||""]}),(0,g.jsxs)("form",{onSubmit:async a=>{a.preventDefault();let b=parseFloat(y.amount);if(!b||isNaN(b))return alert("Enter a valid amount");try{v(!0);let a=(()=>{try{return localStorage.getItem("token")}catch(a){return null}})(),c=y.notes||"";c=y.methodDetail?`${y.method} - ${y.methodDetail}${c?" | "+c:""}`:`${y.method}${c?" | "+c:""}`;let d={donorId:s.donor.id,amount:b,campaignId:y.campaignId||null,method:y.method,notes:c},e=await fetch("/api/donations",{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(d)});if(!e.ok){let a=await e.json().catch(()=>({}));return alert("Record failed: "+(a.error||"unknown"))}await I(),t(null)}catch(a){console.warn(a),alert("Failed to record donation")}finally{v(!1)}},style:{display:"flex",flexDirection:"column",gap:12,marginTop:12},children:[(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Amount"}),(0,g.jsx)("input",{className:"input",type:"number",min:"0",step:"0.01",value:y.amount,onChange:a=>z({...y,amount:a.target.value}),placeholder:"0.00"}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Apply To (optional)"}),(0,g.jsxs)("select",{className:"input",value:y.campaignId||"",onChange:a=>z({...y,campaignId:a.target.value||""}),children:[(0,g.jsx)("option",{value:"",children:"General / Unrestricted"}),m.map(a=>(0,g.jsx)("option",{value:a.id,children:a.name||a.title||a.name},a.id))]}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Payment Method"}),(0,g.jsxs)("select",{className:"input",value:y.method,onChange:a=>z({...y,method:a.target.value}),children:[(0,g.jsx)("option",{value:"CARD",children:"Card"}),(0,g.jsx)("option",{value:"CHECK",children:"Check"}),(0,g.jsx)("option",{value:"CASH",children:"Cash"}),(0,g.jsx)("option",{value:"OTHER",children:"Other"})]}),"CARD"===y.method&&(0,g.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 120px",gap:8},children:[(0,g.jsx)("input",{className:"input",placeholder:"Card type (Visa/Master)",value:y.methodDetail||"",onChange:a=>z({...y,methodDetail:a.target.value})}),(0,g.jsx)("input",{className:"input",placeholder:"Last 4",maxLength:4,value:(y.methodDetail&&4===y.methodDetail.length&&y.methodDetail,y.methodDetail),onChange:a=>z({...y,methodDetail:a.target.value.replace(/[^0-9]/g,"").slice(0,4)})})]}),"CHECK"===y.method&&(0,g.jsx)("input",{className:"input",placeholder:"Check number",value:y.methodDetail||"",onChange:a=>z({...y,methodDetail:a.target.value})}),"OTHER"===y.method&&(0,g.jsx)("input",{className:"input",placeholder:"Method detail",value:y.methodDetail||"",onChange:a=>z({...y,methodDetail:a.target.value})}),(0,g.jsx)("label",{style:{fontSize:12,color:"#bbb"},children:"Notes / Gift Designation"}),(0,g.jsx)("textarea",{className:"input",rows:3,value:y.notes,onChange:a=>z({...y,notes:a.target.value})}),(0,g.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,g.jsx)("button",{type:"button",className:"btn btn-ghost",onClick:()=>{t(null)},children:"Cancel"}),(0,g.jsx)("button",{className:"btn btn-primary",disabled:u,children:u?"Recording...":"Record Donation"})]})]})]})}),A&&(0,g.jsx)("div",{className:"dialog-backdrop",children:(0,g.jsxs)("div",{style:{width:420,background:"var(--color-off-black)",border:"1px solid rgba(255,255,255,0.04)",padding:18,borderRadius:8},children:[(0,g.jsx)("h3",{style:{color:"var(--color-neon)"},children:"Donor Summary"}),(0,g.jsxs)("div",{style:{marginTop:8},children:[(0,g.jsxs)("div",{style:{fontWeight:700},children:[A.donor.firstName," ",A.donor.lastName||""]}),(0,g.jsx)("div",{style:{fontSize:13,color:"#bbb"},children:A.donor.email}),A.error?(0,g.jsx)("div",{style:{color:"#ff8080",marginTop:8},children:A.error}):(0,g.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#bbb"},children:[(0,g.jsxs)("div",{children:["Gifts: ",(0,g.jsxs)("strong",{style:{color:"var(--color-neon)"},children:["$",A.totalGiving||0]})]}),(0,g.jsxs)("div",{style:{marginTop:6},children:["Gifted amount: ",(0,g.jsxs)("strong",{style:{color:"var(--color-neon)"},children:["$",A.giftedTotal||0]})]}),(0,g.jsxs)("div",{style:{marginTop:6},children:["Number of gifts: ",A.gifts||0]}),A.lastGiftAt&&(0,g.jsxs)("div",{style:{marginTop:6},children:["Last gift: ",A.lastGiftAt]})]})]}),(0,g.jsxs)("div",{style:{display:"flex",gap:8,justifyContent:"flex-end",marginTop:12},children:[(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>B(null),children:"Close"}),(0,g.jsx)("button",{className:"btn",onClick:()=>{D(A),B(null)},children:"View Full"})]})]})}),C&&(0,g.jsx)("div",{className:"dialog-backdrop",children:(0,g.jsxs)("div",{style:{width:720,maxHeight:"80vh",overflowY:"auto",background:"var(--color-off-black)",border:"1px solid rgba(255,255,255,0.04)",padding:18,borderRadius:8},children:[(0,g.jsxs)("h3",{style:{color:"var(--color-neon)"},children:[C.donor.firstName," ",C.donor.lastName||""," — Full History"]}),(0,g.jsx)("div",{style:{color:"#bbb",marginTop:8},children:C.donor.email}),(0,g.jsxs)("div",{style:{marginTop:12},children:[(0,g.jsxs)("div",{style:{fontWeight:700},children:["Total Giving: ",(0,g.jsxs)("span",{style:{color:"var(--color-neon)"},children:["$",C.totalGiving||0]})]}),(0,g.jsxs)("div",{style:{marginTop:8},children:["Gifts: ",(0,g.jsxs)("strong",{style:{color:"var(--color-neon)"},children:["$",C.giftedTotal||0]})]})]}),(0,g.jsxs)("div",{style:{marginTop:12},children:[(0,g.jsx)("div",{style:{fontWeight:700,marginBottom:8},children:"Donation History"}),(0,g.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:(C.donations||[]).map(a=>(0,g.jsxs)("div",{style:{padding:8,border:"1px solid rgba(255,255,255,0.03)",borderRadius:6,display:"flex",justifyContent:"space-between"},children:[(0,g.jsxs)("div",{children:[(0,g.jsxs)("div",{style:{fontWeight:700},children:["$",a.amount]}),(0,g.jsx)("div",{style:{fontSize:12,color:"#bbb"},children:new Date(a.date).toLocaleDateString()})]}),(0,g.jsx)("div",{style:{fontSize:12,color:"#bbb"},children:a.campaignId?`Campaign: ${a.campaignId}`:""})]},a.id))})]}),(0,g.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:(0,g.jsx)("button",{className:"btn btn-ghost",onClick:()=>D(null),children:"Close"})})]})})]})}a.s(["default",()=>j],67653);var k=a.i(67653),l=a.i(9193);let m=(0,d.hoist)(k,"default"),n=(0,d.hoist)(k,"getStaticProps"),o=(0,d.hoist)(k,"getStaticPaths"),p=(0,d.hoist)(k,"getServerSideProps"),q=(0,d.hoist)(k,"config"),r=(0,d.hoist)(k,"reportWebVitals"),s=(0,d.hoist)(k,"unstable_getStaticProps"),t=(0,d.hoist)(k,"unstable_getStaticPaths"),u=(0,d.hoist)(k,"unstable_getStaticParams"),v=(0,d.hoist)(k,"unstable_getServerProps"),w=(0,d.hoist)(k,"unstable_getServerSideProps"),x=new b.PagesRouteModule({definition:{kind:c.RouteKind.PAGES,page:"/admin/donors",pathname:"/admin/donors",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:f.default,Document:e.default},userland:k}),y=(0,l.getHandler)({srcPage:"/admin/donors",config:q,userland:k,routeModule:x,getStaticPaths:o,getStaticProps:n,getServerSideProps:p});a.s(["config",0,q,"default",0,m,"getServerSideProps",0,p,"getStaticPaths",0,o,"getStaticProps",0,n,"handler",0,y,"reportWebVitals",0,r,"routeModule",0,x,"unstable_getServerProps",0,v,"unstable_getServerSideProps",0,w,"unstable_getStaticParams",0,u,"unstable_getStaticPaths",0,t,"unstable_getStaticProps",0,s],83519)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_pages_99e2516c.js.map