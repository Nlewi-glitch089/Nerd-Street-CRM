module.exports=[70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},29173,(e,t,r)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},96187,(e,t,r)=>{t.exports=e.x("jsonwebtoken",()=>require("jsonwebtoken"))},3064,e=>{"use strict";var t=e.i(96187),r=e.i(29173);let n=e.g.__prisma||new r.PrismaClient;e.g.__prisma||(e.g.__prisma=n);let i=process.env.JWT_SECRET||"dev-secret";function a(e){return t.default.sign(e,i,{expiresIn:"7d"})}async function o(e){let r=function(e){try{return t.default.verify(e,i)}catch(e){return null}}(e);return r&&r.userId?await n.user.findUnique({where:{id:r.userId}}):null}e.s(["getUserFromToken",()=>o,"signToken",()=>a])},5222,e=>{"use strict";let t;var r=e.i(26747),n=e.i(90406),i=e.i(44898),a=e.i(62950),o=e.i(3064),s=e.i(29173);async function d(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let n=e.headers.authorization||"",i=n&&n.startsWith("Bearer ")?n.slice(7):null;if(!i)return r.status(401).json({error:"Missing authorization token"});let a=await (0,o.getUserFromToken)(i);if(!a)return r.status(401).json({error:"Invalid or expired token"});if("ADMIN"!==a.role)return r.status(403).json({error:"Admin role required"});let{password:s,mode:d,limit:u}=e.body||{};if(!s)return r.status(400).json({error:"Password required"});if(s!==a.password)return r.status(403).json({error:"Password incorrect"});try{let e=await t.donation.findMany({select:{id:!0,donorId:!0,campaignId:!0,amount:!0,date:!0}}),n={};for(let t of e){let e=t.date?new Date(t.date).toISOString().slice(0,10):"null",r=`${t.donorId||"null"}::${t.campaignId||"null"}::${Number(t.amount||0)}::${e}`;n[r]=n[r]||{key:r,donorId:t.donorId,campaignId:t.campaignId,amount:Number(t.amount||0),date:e,ids:[]},n[r].ids.push(t.id)}let i=Object.values(n).filter(e=>e.ids.length>1);if("number"==typeof u&&i.splice(u),"preview"==("remove"===d?"remove":"preview"))return r.status(200).json({ok:!0,mode:"preview",duplicateGroupsCount:i.length,duplicateGroups:i.map(e=>({...e,count:e.ids.length}))});let a=[];for(let e of i){let r=e.ids.map(e=>String(e)).sort(),n=r[0],i=r.slice(1);if(0===i.length)continue;let o=await t.donation.deleteMany({where:{id:{in:i}}});a.push({key:e.key,kept:n,removedCount:o.count||0,removedIds:i})}return r.status(200).json({ok:!0,mode:"remove",removedCount:a.reduce((e,t)=>e+(t.removedCount||0),0),removed:a})}catch(e){return console.error("Dedupe donations error",e),r.status(500).json({error:"Dedupe failed",details:String(e)})}}e.g.__prisma||(e.g.__prisma=new s.PrismaClient),t=e.g.__prisma,e.s(["default",()=>d],55846);var u=e.i(55846),l=e.i(7031),p=e.i(81927),m=e.i(46432);let c=(0,a.hoist)(u,"default"),f=(0,a.hoist)(u,"config"),g=new i.PagesAPIRouteModule({definition:{kind:n.RouteKind.PAGES_API,page:"/api/admin/dedupe-donations",pathname:"/api/admin/dedupe-donations",bundlePath:"",filename:""},userland:u,distDir:".next",relativeProjectDir:""});async function v(e,t,n){g.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/dedupe-donations";i=i.replace(/\/index$/,"")||"/";let a=await g.prepare(e,t,{srcPage:i});if(!a){t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve());return}let{query:o,params:s,prerenderManifest:d,routerServerContext:u}=a;try{let r=e.method||"GET",n=(0,l.getTracer)(),a=n.getActiveScopeSpan(),m=g.instrumentationOnRequestError.bind(g),c=async a=>g.render(e,t,{query:{...o,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:g.isDev,page:"/api/admin/dedupe-donations",internalRevalidate:null==u?void 0:u.revalidate,onError:(...t)=>m(e,...t)}).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=n.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${r} ${o}`;a.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),a.updateName(e)}else a.updateName(`${r} ${i}`)});a?await c(a):await n.withPropagatedContext(e.headers,()=>n.trace(p.BaseServerSpan.handleRequest,{spanName:`${r} ${i}`,kind:l.SpanKind.SERVER,attributes:{"http.method":r,"http.target":e.url}},c))}catch(e){if(g.isDev)throw e;(0,r.sendError)(t,500,"Internal Server Error")}finally{null==n.waitUntil||n.waitUntil.call(n,Promise.resolve())}}e.s(["config",0,f,"default",0,c,"handler",()=>v],5222)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__21062a95._.js.map