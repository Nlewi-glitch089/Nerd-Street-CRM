module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},29173,(e,t,a)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},96187,(e,t,a)=>{t.exports=e.x("jsonwebtoken",()=>require("jsonwebtoken"))},3064,e=>{"use strict";var t=e.i(96187),a=e.i(29173);let i=e.g.__prisma||new a.PrismaClient;e.g.__prisma||(e.g.__prisma=i);let r=process.env.JWT_SECRET||"dev-secret";function n(e){return t.default.sign(e,r,{expiresIn:"7d"})}async function o(e){let a=function(e){try{return t.default.verify(e,r)}catch(e){return null}}(e);return a&&a.userId?await i.user.findUnique({where:{id:a.userId}}):null}e.s(["getUserFromToken",()=>o,"signToken",()=>n])},29320,e=>{"use strict";let t;var a=e.i(26747),i=e.i(90406),r=e.i(44898),n=e.i(62950),o=e.i(3064),s=e.i(29173);async function d(e,a){if("POST"!==e.method)return a.status(405).json({error:"Method not allowed"});let i=e.headers.authorization||"",r=i&&i.startsWith("Bearer ")?i.slice(7):null;if(!r)return a.status(401).json({error:"Missing authorization token"});let n=await (0,o.getUserFromToken)(r);if(!n)return a.status(401).json({error:"Invalid or expired token"});if("ADMIN"!==n.role)return a.status(403).json({error:"Admin role required"});let{password:s,renames:d,byId:l}=e.body||{};if(!s)return a.status(400).json({error:"Password required"});if(s!==n.password)return a.status(403).json({error:"Password incorrect"});let u=[];try{if(Array.isArray(d))for(let e of d){let a=String(e.oldName||"").trim(),i=String(e.newName||"").trim();if(!a||!i){u.push({oldName:a,newName:i,error:"Invalid names"});continue}let r=await t.campaign.findMany({where:{name:a},include:{donations:!0}});if(!r||0===r.length){u.push({oldName:a,newName:i,note:"No campaigns found with that oldName"});continue}let n=await t.campaign.findFirst({where:{name:i}});if(n){let e=0;for(let a of r){if(a.id===n.id)continue;let i=await t.donation.updateMany({where:{campaignId:a.id},data:{campaignId:n.id}});e+=i.count||0,await t.campaign.delete({where:{id:a.id}})}u.push({oldName:a,newName:i,action:"mergedIntoExisting",keptId:n.id,movedDonations:e});continue}r.sort((e,t)=>e.id<t.id?-1:1);let o=r[0],s=0;for(let e of r.slice(1)){let a=await t.donation.updateMany({where:{campaignId:e.id},data:{campaignId:o.id}});s+=a.count||0,await t.campaign.delete({where:{id:e.id}})}let d=await t.campaign.update({where:{id:o.id},data:{name:i}});u.push({oldName:a,newName:i,action:"renamed",keptId:o.id,movedDonations:s,updated:d})}if(Array.isArray(l))for(let e of l){let a=String(e.id||""),i=String(e.newName||"").trim();if(!a||!i){u.push({id:a,newName:i,error:"Invalid id or newName"});continue}let r=await t.campaign.findUnique({where:{id:a},include:{donations:!0}});if(!r){u.push({id:a,newName:i,error:"Campaign not found"});continue}let n=await t.campaign.findFirst({where:{name:i}});if(n&&n.id!==r.id){let e=await t.donation.updateMany({where:{campaignId:r.id},data:{campaignId:n.id}});await t.campaign.delete({where:{id:r.id}}),u.push({id:a,newName:i,action:"mergedIntoExisting",keptId:n.id,movedDonations:e.count||0});continue}let o=await t.campaign.update({where:{id:a},data:{name:i}});u.push({id:a,newName:i,action:"renamed",updated:o})}return a.status(200).json({ok:!0,results:u})}catch(e){return console.error("Rename campaigns error",e),a.status(500).json({error:"Rename failed",details:String(e)})}}e.g.__prisma||(e.g.__prisma=new s.PrismaClient),t=e.g.__prisma,e.s(["default",()=>d],59954);var l=e.i(59954),u=e.i(7031),p=e.i(81927),m=e.i(46432);let c=(0,n.hoist)(l,"default"),g=(0,n.hoist)(l,"config"),f=new r.PagesAPIRouteModule({definition:{kind:i.RouteKind.PAGES_API,page:"/api/admin/rename-campaigns",pathname:"/api/admin/rename-campaigns",bundlePath:"",filename:""},userland:l,distDir:".next",relativeProjectDir:""});async function h(e,t,i){f.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/admin/rename-campaigns";r=r.replace(/\/index$/,"")||"/";let n=await f.prepare(e,t,{srcPage:r});if(!n){t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve());return}let{query:o,params:s,prerenderManifest:d,routerServerContext:l}=n;try{let a=e.method||"GET",i=(0,u.getTracer)(),n=i.getActiveScopeSpan(),m=f.instrumentationOnRequestError.bind(f),c=async n=>f.render(e,t,{query:{...o,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:f.isDev,page:"/api/admin/rename-campaigns",internalRevalidate:null==l?void 0:l.revalidate,onError:(...t)=>m(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=i.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${a} ${o}`;n.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),n.updateName(e)}else n.updateName(`${a} ${r}`)});n?await c(n):await i.withPropagatedContext(e.headers,()=>i.trace(p.BaseServerSpan.handleRequest,{spanName:`${a} ${r}`,kind:u.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},c))}catch(e){if(f.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==i.waitUntil||i.waitUntil.call(i,Promise.resolve())}}e.s(["config",0,g,"default",0,c,"handler",()=>h],29320)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8bb902b1._.js.map