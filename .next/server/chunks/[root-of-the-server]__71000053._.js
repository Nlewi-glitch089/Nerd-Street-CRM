module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},29173,(e,t,a)=>{t.exports=e.x("@prisma/client",()=>require("@prisma/client"))},96187,(e,t,a)=>{t.exports=e.x("jsonwebtoken",()=>require("jsonwebtoken"))},3064,e=>{"use strict";var t=e.i(96187),a=e.i(29173);let r=e.g.__prisma||new a.PrismaClient;e.g.__prisma||(e.g.__prisma=r);let i=process.env.JWT_SECRET||"dev-secret";function n(e){return t.default.sign(e,i,{expiresIn:"7d"})}async function o(e){let a=function(e){try{return t.default.verify(e,i)}catch(e){return null}}(e);return a&&a.userId?await r.user.findUnique({where:{id:a.userId}}):null}e.s(["getUserFromToken",()=>o,"signToken",()=>n])},91856,e=>{"use strict";let t;var a=e.i(26747),r=e.i(90406),i=e.i(44898),n=e.i(62950),o=e.i(3064),s=e.i(29173);async function d(e,a){if("POST"!==e.method)return a.status(405).json({error:"Method not allowed"});let r=e.headers.authorization||"",i=r&&r.startsWith("Bearer ")?r.slice(7):null;if(!i)return a.status(401).json({error:"Missing authorization token"});let n=await (0,o.getUserFromToken)(i);if(!n)return a.status(401).json({error:"Invalid or expired token"});if("ADMIN"!==n.role)return a.status(403).json({error:"Admin role required"});let{password:s,campaigns:d}=e.body||{};if(!s)return a.status(400).json({error:"Password required"});if(s!==n.password)return a.status(403).json({error:"Password incorrect"});if(!Array.isArray(d))return a.status(400).json({error:"campaigns array required"});let l=[];try{for(let e of d){let a=String(e.name||"").trim(),r=Number(e.goal||0)||0,i=Number(e.donationsAmount||0)||0,n=Number(e.inKindAmount||0)||0;if(!a){l.push({name:a,error:"Invalid name"});continue}try{for(let e of(await t.campaign.findMany({where:{name:a}})))await t.donation.deleteMany({where:{campaignId:e.id}}),await t.campaign.delete({where:{id:e.id}})}catch(e){console.warn("Failed to remove existing campaigns for",a,e)}let o=await t.campaign.create({data:{name:a,goal:r,approved:i+n>0}}),s=`seed+${o.id}@example.com`,d=await t.donor.upsert({where:{email:s},update:{},create:{firstName:"Seed",lastName:`${o.id}`,email:s,totalGiving:0}}),u=[];if(i>0){let e=await t.donation.create({data:{donorId:d.id,amount:i,campaignId:o.id,date:new Date,method:"CARD",notes:"Seeded donation"}});u.push(e)}if(n>0){let e=await t.donation.create({data:{donorId:d.id,amount:n,campaignId:o.id,date:new Date,method:"IN_KIND",notes:"Seeded in-kind gift"}});u.push(e)}try{let e=await t.donation.aggregate({where:{donorId:d.id},_sum:{amount:!0},_max:{date:!0}});await t.donor.update({where:{id:d.id},data:{totalGiving:e._sum.amount||0,lastGiftAt:e._max.date||null}})}catch(e){console.warn("Failed to update donor agg",e)}l.push({name:a,campaignId:o.id,donationsCreated:u.length,donations:u.map(e=>({id:e.id,amount:e.amount,method:e.method}))})}return a.status(200).json({ok:!0,results:l})}catch(e){return console.error("Replace campaigns error",e),a.status(500).json({error:"Replace failed",details:String(e)})}}e.g.__prisma||(e.g.__prisma=new s.PrismaClient),t=e.g.__prisma,e.s(["default",()=>d],66006);var l=e.i(66006),u=e.i(7031),p=e.i(81927),m=e.i(46432);let c=(0,n.hoist)(l,"default"),g=(0,n.hoist)(l,"config"),h=new i.PagesAPIRouteModule({definition:{kind:r.RouteKind.PAGES_API,page:"/api/admin/replace-campaigns",pathname:"/api/admin/replace-campaigns",bundlePath:"",filename:""},userland:l,distDir:".next",relativeProjectDir:""});async function f(e,t,r){h.isDev&&(0,m.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let i="/api/admin/replace-campaigns";i=i.replace(/\/index$/,"")||"/";let n=await h.prepare(e,t,{srcPage:i});if(!n){t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve());return}let{query:o,params:s,prerenderManifest:d,routerServerContext:l}=n;try{let a=e.method||"GET",r=(0,u.getTracer)(),n=r.getActiveScopeSpan(),m=h.instrumentationOnRequestError.bind(h),c=async n=>h.render(e,t,{query:{...o,...s},params:s,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:d.preview,propagateError:!1,dev:h.isDev,page:"/api/admin/replace-campaigns",internalRevalidate:null==l?void 0:l.revalidate,onError:(...t)=>m(e,...t)}).finally(()=>{if(!n)return;n.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let e=r.getRootSpanAttributes();if(!e)return;if(e.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${e.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=e.get("next.route");if(o){let e=`${a} ${o}`;n.setAttributes({"next.route":o,"http.route":o,"next.span_name":e}),n.updateName(e)}else n.updateName(`${a} ${i}`)});n?await c(n):await r.withPropagatedContext(e.headers,()=>r.trace(p.BaseServerSpan.handleRequest,{spanName:`${a} ${i}`,kind:u.SpanKind.SERVER,attributes:{"http.method":a,"http.target":e.url}},c))}catch(e){if(h.isDev)throw e;(0,a.sendError)(t,500,"Internal Server Error")}finally{null==r.waitUntil||r.waitUntil.call(r,Promise.resolve())}}e.s(["config",0,g,"default",0,c,"handler",()=>f],91856)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__71000053._.js.map